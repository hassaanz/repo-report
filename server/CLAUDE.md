# Git History Report Server - Claude Configuration

## Project Setup

This is a TypeScript web server built with Bun, Fastify, and TypeScript that serves git history reports generated by the bash script and provides a complete integration system with upload scripts.

## Development Commands

```bash
# Install dependencies
bun install

# Start development server
bun run dev

# Build for production
bun run build

# Start production server
bun run start

# Run tests
bun test

# Test server functionality end-to-end
bun run test:functionality

# Lint code
bun run lint

# Type check
bun run typecheck
```

## Technology Stack

- **Runtime**: Bun (JavaScript runtime)
- **Framework**: Fastify (web framework)
- **Language**: TypeScript
- **Process Management**: Child processes for bash script execution
- **Templating**: HTML generation from bash script output

## Project Structure

```
server/
├── src/
│   ├── routes/          # API route handlers
│   ├── services/        # Business logic
│   ├── types/           # TypeScript type definitions
│   ├── utils/           # Utility functions
│   └── server.ts        # Main server entry point
├── package.json
├── tsconfig.json
├── .gitignore
└── README.md
```

## Environment Variables

- `PORT` - Server port (default: 3000)
- `HOST` - Server host (default: localhost)
- `NODE_ENV` - Environment (development/production)
- `REPORT_TTL` - Report URL time-to-live in seconds (default: 3600)

## API Endpoints

- `GET /` - Web interface with interactive documentation and usage guide
- `POST /api/reports` - Accept HTML content and create short-lived URL
- `GET /r/:reportHash` - View generated report by hash ID
- `GET /api/health` - Server health check endpoint
- `GET /api/reports/health` - Reports service health with statistics
- `GET /api/reports/:reportHash/metadata` - Get report metadata

## Features

- **Web Interface**: Beautiful interactive documentation at root URL
- **Report Storage**: Accept HTML content via API and generate shareable URLs
- **Hash-based URLs**: f(reportHash, currentEpoch, expireEpoch) = filename system
- **Automatic Cleanup**: Reports expire automatically with configurable TTL
- **Integration Scripts**: Work seamlessly with upload scripts in ../scripts/
- **Error Handling**: Comprehensive validation and error responses

## Integration with Scripts

The server works with two main integration scripts:

### ../scripts/upload-report.sh
- Accepts piped HTML content from stdin
- Uploads to server via POST /api/reports
- Returns shareable URL with expiration info
- Supports custom TTL, server URL, verbose/quiet modes

### ../scripts/generate-and-upload.sh
- Generates reports using ../bash/git-history-report.sh
- Pipes output to upload-report.sh
- Supports all bash script options plus upload options
- Dry-run mode for testing

## Quick Testing

```bash
# Test the upload pipeline
echo '<html><body><h1>Test</h1></body></html>' | ../scripts/upload-report.sh --verbose

# Test full generation and upload
../scripts/generate-and-upload.sh --preset today --verbose

# Run comprehensive functionality test
bun run test:functionality
```